<html>
<body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link href="/site.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="springy.js"></script>
<script src="springyui.js"></script>
<script type="module">
  import { parse } from './parser.js';

  var graph = new Springy.Graph();
  // graph.addNodes('Dennis', 'Michael', 'Jessica', 'Timothy', 'Barbara')
  // graph.addNodes('Amphitryon', 'Alcmene', 'Iphicles', 'Heracles');

  // graph.addEdges(
  //   ['Dennis', 'Michael', {color: '#00A0B0', label: 'Foo bar'}],
  //   ['Michael', 'Dennis', {color: '#6A4A3C'}],
  //   ['Michael', 'Jessica', {color: '#CC333F'}],
  //   ['Jessica', 'Barbara', {color: '#EB6841'}],
  //   ['Michael', 'Timothy', {color: '#EDC951'}],
  //   ['Amphitryon', 'Alcmene', {color: '#7DBE3C'}],
  //   ['Alcmene', 'Amphitryon', {color: '#BE7D3C'}],
  //   ['Amphitryon', 'Iphicles'],
  //   ['Amphitryon', 'Heracles'],
    
  //   ['Barbara', 'Timothy', {color: '#6A4A3C'}]
  // );
  $("#refresh").click(function() {
    refreshCloud();
  });

  $('#inputData').on('input',function() {
    refreshCloud();
  });

  refreshCloud();

  jQuery(function(){
    var springy = jQuery('#springydemo').springy({
      graph: graph
    });
  });

  function refreshCloud(){
    // graph = new Springy.Graph();
    var inputData = $("#inputData").val();
    var data = parse(inputData);
    graph.clear();

    renderRecursive(data, true);
    // data.forEach(element => {
    //   graph.addNodes(element);
    // });
  }

  function renderRecursive(data, isRoot){
    if (isRoot) {
      graph.addNodes({name: data.title, color: '#00A0B0', font: "32px Arial, sans-serif"}); 
    } 
    else {
      graph.addNodes(data.title);
    }
    if (data.childNodes){
      data.childNodes.forEach(element => {
        renderRecursive(element);
        graph.addEdges([data.title, element.title, {color: '#00A0B0'}]);
      });
    }
  }

  // jQuery(function(){
  //   var springy = jQuery('#springydemo').springy({
  //     graph: graph
  //   });
  // });

</script>
<div class="Container-flow">
  <div class="row">
    <div class="col-9">
      <canvas id="springydemo" width="1900px" height="1200px"></canvas>
    </div>
    <div class="col-3">
      <textarea id="inputData" style="width: 100%; height: 80%">Test
  Test 1
    Test 1.1
    Test 1.2
    Test 1.3
  Test 2</textarea>
      <br/>
      <button id="refresh">Refresh Cloud</button>
    </div>
  </div>
</div>

</body>
</html>
